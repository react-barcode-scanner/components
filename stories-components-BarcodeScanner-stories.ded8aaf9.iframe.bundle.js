"use strict";(globalThis.webpackChunk_react_barcode_scanner_components=globalThis.webpackChunk_react_barcode_scanner_components||[]).push([[74],{"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./src/components/BarcodeScanner.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".webcam-scanner-preview-box {\n    --video-border: solid 1px #ccc;\n    --scanline: solid 3px #ff000099;\n\n    --assume-video-width: 640px;\n    --assume-video-height: 480px;\n    --assume-zoom: 2;\n\n    --video-crop-width: 640px;\n    --video-crop-height: 300px;\n\n    --video-blur: 3px;\n\n    --video-element-width: calc(var(--assume-video-width) - var(--video-blur) * 2);\n    --video-element-height: calc(var(--assume-video-height) - var(--video-blur) * 2);\n\n    --video-element-top: calc(\n        (var(--video-crop-height) - var(--video-element-height)) / 2 - var(--video-blur)\n    );\n    --video-element-left: calc(\n        (var(--video-crop-width) - var(--video-element-width)) / 2 - var(--video-blur)\n    );\n\n    --canvas-element-width: calc(var(--assume-video-width) / var(--assume-zoom));\n    --canvas-element-height: calc(var(--assume-video-height) / var(--assume-zoom));\n    --canvas-element-left: calc(\n        (var(--video-crop-width) - var(--canvas-element-width)) / var(--assume-zoom) -\n            var(--video-blur)\n    );\n    --canvas-element-top: calc(\n        (var(--video-crop-height) - var(--canvas-element-height)) / var(--assume-zoom) -\n            var(--video-blur)\n    );\n}\n\n.webcam-scanner-preview-box {\n    display: flex;\n    justify-content: center;\n}\n\n.webcam-scanner-preview {\n    border: var(--video-border);\n    position: relative;\n    height: var(--video-crop-height);\n    width: var(--video-crop-width);\n    overflow: hidden;\n}\n.webcam-scanner-preview > canvas {\n    position: absolute;\n    left: var(--canvas-element-left);\n    top: var(--canvas-element-top);\n    width: var(--canvas-element-width);\n    height: var(--canvas-element-height);\n}\n\n/* for confirming that the zoom center is correct */\n/*.webcam-scanner-preview {*/\n/*    overflow: visible;*/\n/*}*/\n/*.webcam-scanner-preview > canvas {*/\n/*    left: var(--assume-video-width);*/\n/*}*/\n/*.webcam-scanner-preview > .match-canvas {*/\n/*    border: solid 1px white;*/\n/*    position: absolute;*/\n/*    width: 160px;*/\n/*    height: 120px;*/\n/*    left: calc((640px / 2 - 320px / 4) - 3px);*/\n/*    top: calc((480px / 2 - 240px / 4) - 3px);*/\n/*}*/\n\n.webcam-scanner-preview > video {\n    position: absolute;\n    top: var(--video-element-top);\n    left: var(--video-element-left);\n    filter: blur(var(--video-blur));\n}\n\n.scanline {\n    position: absolute;\n    left: var(--canvas-element-left);\n    top: var(--canvas-element-top);\n    width: var(--canvas-element-width);\n    height: 1px;\n    overflow: hidden;\n\n    border-top: var(--scanline);\n\n    animation-name: scanline;\n    animation-iteration-count: infinite;\n    animation-duration: 1.5s;\n    animation-timing-function: linear;\n}\n\n@keyframes scanline {\n    from {\n        top: var(--canvas-element-top);\n    }\n    to {\n        top: calc(var(--canvas-element-top) + var(--canvas-element-height));\n    }\n}\n","",{version:3,sources:["webpack://./src/components/BarcodeScanner.css"],names:[],mappings:"AAAA;IACI,8BAA8B;IAC9B,+BAA+B;;IAE/B,2BAA2B;IAC3B,4BAA4B;IAC5B,gBAAgB;;IAEhB,yBAAyB;IACzB,0BAA0B;;IAE1B,iBAAiB;;IAEjB,8EAA8E;IAC9E,gFAAgF;;IAEhF;;KAEC;IACD;;KAEC;;IAED,4EAA4E;IAC5E,8EAA8E;IAC9E;;;KAGC;IACD;;;KAGC;AACL;;AAEA;IACI,aAAa;IACb,uBAAuB;AAC3B;;AAEA;IACI,2BAA2B;IAC3B,kBAAkB;IAClB,gCAAgC;IAChC,8BAA8B;IAC9B,gBAAgB;AACpB;AACA;IACI,kBAAkB;IAClB,gCAAgC;IAChC,8BAA8B;IAC9B,kCAAkC;IAClC,oCAAoC;AACxC;;AAEA,mDAAmD;AACnD,4BAA4B;AAC5B,yBAAyB;AACzB,IAAI;AACJ,qCAAqC;AACrC,uCAAuC;AACvC,IAAI;AACJ,4CAA4C;AAC5C,+BAA+B;AAC/B,0BAA0B;AAC1B,oBAAoB;AACpB,qBAAqB;AACrB,iDAAiD;AACjD,gDAAgD;AAChD,IAAI;;AAEJ;IACI,kBAAkB;IAClB,6BAA6B;IAC7B,+BAA+B;IAC/B,+BAA+B;AACnC;;AAEA;IACI,kBAAkB;IAClB,gCAAgC;IAChC,8BAA8B;IAC9B,kCAAkC;IAClC,WAAW;IACX,gBAAgB;;IAEhB,2BAA2B;;IAE3B,wBAAwB;IACxB,mCAAmC;IACnC,wBAAwB;IACxB,iCAAiC;AACrC;;AAEA;IACI;QACI,8BAA8B;IAClC;IACA;QACI,mEAAmE;IACvE;AACJ",sourcesContent:[".webcam-scanner-preview-box {\n    --video-border: solid 1px #ccc;\n    --scanline: solid 3px #ff000099;\n\n    --assume-video-width: 640px;\n    --assume-video-height: 480px;\n    --assume-zoom: 2;\n\n    --video-crop-width: 640px;\n    --video-crop-height: 300px;\n\n    --video-blur: 3px;\n\n    --video-element-width: calc(var(--assume-video-width) - var(--video-blur) * 2);\n    --video-element-height: calc(var(--assume-video-height) - var(--video-blur) * 2);\n\n    --video-element-top: calc(\n        (var(--video-crop-height) - var(--video-element-height)) / 2 - var(--video-blur)\n    );\n    --video-element-left: calc(\n        (var(--video-crop-width) - var(--video-element-width)) / 2 - var(--video-blur)\n    );\n\n    --canvas-element-width: calc(var(--assume-video-width) / var(--assume-zoom));\n    --canvas-element-height: calc(var(--assume-video-height) / var(--assume-zoom));\n    --canvas-element-left: calc(\n        (var(--video-crop-width) - var(--canvas-element-width)) / var(--assume-zoom) -\n            var(--video-blur)\n    );\n    --canvas-element-top: calc(\n        (var(--video-crop-height) - var(--canvas-element-height)) / var(--assume-zoom) -\n            var(--video-blur)\n    );\n}\n\n.webcam-scanner-preview-box {\n    display: flex;\n    justify-content: center;\n}\n\n.webcam-scanner-preview {\n    border: var(--video-border);\n    position: relative;\n    height: var(--video-crop-height);\n    width: var(--video-crop-width);\n    overflow: hidden;\n}\n.webcam-scanner-preview > canvas {\n    position: absolute;\n    left: var(--canvas-element-left);\n    top: var(--canvas-element-top);\n    width: var(--canvas-element-width);\n    height: var(--canvas-element-height);\n}\n\n/* for confirming that the zoom center is correct */\n/*.webcam-scanner-preview {*/\n/*    overflow: visible;*/\n/*}*/\n/*.webcam-scanner-preview > canvas {*/\n/*    left: var(--assume-video-width);*/\n/*}*/\n/*.webcam-scanner-preview > .match-canvas {*/\n/*    border: solid 1px white;*/\n/*    position: absolute;*/\n/*    width: 160px;*/\n/*    height: 120px;*/\n/*    left: calc((640px / 2 - 320px / 4) - 3px);*/\n/*    top: calc((480px / 2 - 240px / 4) - 3px);*/\n/*}*/\n\n.webcam-scanner-preview > video {\n    position: absolute;\n    top: var(--video-element-top);\n    left: var(--video-element-left);\n    filter: blur(var(--video-blur));\n}\n\n.scanline {\n    position: absolute;\n    left: var(--canvas-element-left);\n    top: var(--canvas-element-top);\n    width: var(--canvas-element-width);\n    height: 1px;\n    overflow: hidden;\n\n    border-top: var(--scanline);\n\n    animation-name: scanline;\n    animation-iteration-count: infinite;\n    animation-duration: 1.5s;\n    animation-timing-function: linear;\n}\n\n@keyframes scanline {\n    from {\n        top: var(--canvas-element-top);\n    }\n    to {\n        top: calc(var(--canvas-element-top) + var(--canvas-element-height));\n    }\n}\n"],sourceRoot:""}]);const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"./node_modules/css-loader/dist/runtime/api.js":module=>{module.exports=function(cssWithMappingToString){var list=[];return list.toString=function toString(){return this.map((function(item){var content="",needLayer=void 0!==item[5];return item[4]&&(content+="@supports (".concat(item[4],") {")),item[2]&&(content+="@media ".concat(item[2]," {")),needLayer&&(content+="@layer".concat(item[5].length>0?" ".concat(item[5]):""," {")),content+=cssWithMappingToString(item),needLayer&&(content+="}"),item[2]&&(content+="}"),item[4]&&(content+="}"),content})).join("")},list.i=function i(modules,media,dedupe,supports,layer){"string"==typeof modules&&(modules=[[null,modules,void 0]]);var alreadyImportedModules={};if(dedupe)for(var k=0;k<this.length;k++){var id=this[k][0];null!=id&&(alreadyImportedModules[id]=!0)}for(var _k=0;_k<modules.length;_k++){var item=[].concat(modules[_k]);dedupe&&alreadyImportedModules[item[0]]||(void 0!==layer&&(void 0===item[5]||(item[1]="@layer".concat(item[5].length>0?" ".concat(item[5]):""," {").concat(item[1],"}")),item[5]=layer),media&&(item[2]?(item[1]="@media ".concat(item[2]," {").concat(item[1],"}"),item[2]=media):item[2]=media),supports&&(item[4]?(item[1]="@supports (".concat(item[4],") {").concat(item[1],"}"),item[4]=supports):item[4]="".concat(supports)),list.push(item))}},list}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":module=>{module.exports=function(item){var content=item[1],cssMapping=item[3];if(!cssMapping)return content;if("function"==typeof btoa){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping)))),data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64),sourceMapping="/*# ".concat(data," */");return[content].concat([sourceMapping]).join("\n")}return[content].join("\n")}},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":module=>{var stylesInDOM=[];function getIndexByIdentifier(identifier){for(var result=-1,i=0;i<stylesInDOM.length;i++)if(stylesInDOM[i].identifier===identifier){result=i;break}return result}function modulesToDom(list,options){for(var idCountMap={},identifiers=[],i=0;i<list.length;i++){var item=list[i],id=options.base?item[0]+options.base:item[0],count=idCountMap[id]||0,identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var indexByIdentifier=getIndexByIdentifier(identifier),obj={css:item[1],media:item[2],sourceMap:item[3],supports:item[4],layer:item[5]};if(-1!==indexByIdentifier)stylesInDOM[indexByIdentifier].references++,stylesInDOM[indexByIdentifier].updater(obj);else{var updater=addElementStyle(obj,options);options.byIndex=i,stylesInDOM.splice(i,0,{identifier,updater,references:1})}identifiers.push(identifier)}return identifiers}function addElementStyle(obj,options){var api=options.domAPI(options);api.update(obj);return function updater(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap&&newObj.supports===obj.supports&&newObj.layer===obj.layer)return;api.update(obj=newObj)}else api.remove()}}module.exports=function(list,options){var lastIdentifiers=modulesToDom(list=list||[],options=options||{});return function update(newList){newList=newList||[];for(var i=0;i<lastIdentifiers.length;i++){var index=getIndexByIdentifier(lastIdentifiers[i]);stylesInDOM[index].references--}for(var newLastIdentifiers=modulesToDom(newList,options),_i=0;_i<lastIdentifiers.length;_i++){var _index=getIndexByIdentifier(lastIdentifiers[_i]);0===stylesInDOM[_index].references&&(stylesInDOM[_index].updater(),stylesInDOM.splice(_index,1))}lastIdentifiers=newLastIdentifiers}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":module=>{var memo={};module.exports=function insertBySelector(insert,style){var target=function getTarget(target){if(void 0===memo[target]){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}(insert);if(!target)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");target.appendChild(style)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":module=>{module.exports=function insertStyleElement(options){var element=document.createElement("style");return options.setAttributes(element,options.attributes),options.insert(element,options.options),element}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function setAttributesWithoutAttributes(styleElement){var nonce=__webpack_require__.nc;nonce&&styleElement.setAttribute("nonce",nonce)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":module=>{module.exports=function domAPI(options){if("undefined"==typeof document)return{update:function update(){},remove:function remove(){}};var styleElement=options.insertStyleElement(options);return{update:function update(obj){!function apply(styleElement,options,obj){var css="";obj.supports&&(css+="@supports (".concat(obj.supports,") {")),obj.media&&(css+="@media ".concat(obj.media," {"));var needLayer=void 0!==obj.layer;needLayer&&(css+="@layer".concat(obj.layer.length>0?" ".concat(obj.layer):""," {")),css+=obj.css,needLayer&&(css+="}"),obj.media&&(css+="}"),obj.supports&&(css+="}");var sourceMap=obj.sourceMap;sourceMap&&"undefined"!=typeof btoa&&(css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")),options.styleTagTransform(css,styleElement,options.options)}(styleElement,options,obj)},remove:function remove(){!function removeStyleElement(styleElement){if(null===styleElement.parentNode)return!1;styleElement.parentNode.removeChild(styleElement)}(styleElement)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":module=>{module.exports=function styleTagTransform(css,styleElement){if(styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}},"./src/stories/components/BarcodeScanner.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>BarcodeScanner_stories});var react=__webpack_require__("./node_modules/react/index.js"),listDevices=function(){return navigator.mediaDevices.enumerateDevices().then((function(devices){return devices.filter((function(device){return"videoinput"===device.kind}))}))},getMediaConstraintsForDeviceChoiceOptions=function(deviceList,deviceChoiceOptions){var constraints={audio:!1,video:!0};if(0!==deviceList.length){if(1===deviceList.length)return constraints;var advancedConstraints=[],deviceId=deviceChoiceOptions.deviceId,matcher=deviceChoiceOptions.matcher,facingMode=deviceChoiceOptions.facingMode,width=deviceChoiceOptions.width,height=deviceChoiceOptions.height;if(constraints.video={width,height},deviceId&&advancedConstraints.push({deviceId}),!deviceId&&matcher){var matched=deviceList.filter((function(deviceInfo){return matcher.test(deviceInfo.label)}));1===matched.length&&advancedConstraints.push({deviceId:matched[0].deviceId}),matched.length>1&&facingMode&&(advancedConstraints=advancedConstraints.concat(matched.map((function(matchingDevice){return{deviceId:matchingDevice.deviceId,facingMode}}))))}return deviceId||matcher||!facingMode||advancedConstraints.push({facingMode}),advancedConstraints.length>0&&(constraints.video={width,height,advanced:advancedConstraints}),constraints}},getUserMedia=function(constraints,context){return navigator.mediaDevices.getUserMedia(constraints).then((function(stream){return stream}))},removeStreamTracks=function(stream){stream.getTracks().forEach((function(track){track.enabled=!1,track.stop(),stream.removeTrack(track)}))},resolveCameraPermission=function(){return navigator.mediaDevices.enumerateDevices().then((function(mediaDeviceInfos){return void 0!==mediaDeviceInfos.find((function(mediaDeviceInfo){var _a;return(null===(_a=mediaDeviceInfo.deviceId)||void 0===_a?void 0:_a.length)>0}))})).then((function(hasDeviceLabels){return hasDeviceLabels?Promise.resolve(!0):getUserMedia({video:!0,audio:!1}).then((function(stream){return removeStreamTracks(stream),!0})).catch((function(){return!1}))}))};function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var barcodeDetector,barcodeDetectorOptions={formats:["ean_13","upc_a"]},useScanCanvas=function(onScan){var canvasRef=(0,react.useRef)(null),detectedBarcodesRef=(0,react.useRef)(new Map),_a=(0,react.useState)(!0),canDetect=_a[0],setCanDetect=_a[1];return{onDraw:function(){return canvasRef.current&&canDetect?function(options){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return barcodeDetector?[2,barcodeDetector]:"BarcodeDetector"in window?[3,2]:[4,__webpack_require__.e(428).then(__webpack_require__.bind(__webpack_require__,"../../node_modules/@undecaf/barcode-detector-polyfill/dist/main.js")).then((function(BCD){var BarcodeDetectorPolyfill=BCD.BarcodeDetectorPolyfill;window.BarcodeDetector=BarcodeDetectorPolyfill}))];case 1:_a.sent(),_a.label=2;case 2:return[2,window.BarcodeDetector.getSupportedFormats().then((function(formats){return 0===formats.length?Promise.reject("No barcode detection"):(barcodeDetector=new window.BarcodeDetector(options),Promise.resolve(barcodeDetector))}))]}}))}))}(barcodeDetectorOptions).then((function(barcodeDetector){return canvasRef.current?createImageBitmap(canvasRef.current).then((function(bitmap){var detectedBarcodes=detectedBarcodesRef.current;return null==barcodeDetector?void 0:barcodeDetector.detect(bitmap).then((function(barcodes){barcodes.length>0&&barcodes.filter((function(code){return!detectedBarcodes.has(code.rawValue)})).length>0&&barcodes.forEach((function(barcode){detectedBarcodes.has(barcode.rawValue)||(detectedBarcodes.set(barcode.rawValue,bitmap),null==onScan||onScan(barcode.rawValue))}))})).catch((function(error){console.log("unable to detect",error)}))})):Promise.resolve(void 0)})).catch((function(error){console.error("setting can detect to false"),setCanDetect(!1)})):Promise.resolve(void 0)},canDetect,canvasRef,detectedBarcodesRef}},playWithRetry=function(videoElement){return videoElement.play().catch((function(error){return console.log(error),new Promise((function(resolve){setTimeout((function(){return resolve(playWithRetry(videoElement))}),100)}))}))},useVideoCanvas=function(options){var onDraw=options.onDraw,onPlay=options.onPlay,webcamVideoRef=options.webcamVideoRef,_a=options.shouldDraw,shouldDraw=void 0===_a||_a,canvasRef=options.canvasRef,_b=options.hasPermission,hasPermission=void 0===_b||_b,shouldPlay=options.shouldPlay,_c=options.timeoutDelay,timeoutDelay=void 0===_c?17:_c,_d=options.zoom,zoom=void 0===_d?1:_d,_e=(0,react.useState)(),context=_e[0],setContext=_e[1],_f=(0,react.useState)(!1),hasListener=_f[0],setHasListener=_f[1],bounds=(0,react.useMemo)((function(){var video=webcamVideoRef.current,canvas=canvasRef.current;return video&&canvas?[video.width/2-canvas.width/(2*zoom),video.height/2-canvas.height/(2*zoom),canvas.width/zoom,canvas.height/zoom,0,0,canvas.width,canvas.height]:[0,0,0,0,0,0,0,0]}),[canvasRef.current,webcamVideoRef.current,zoom]),streamToCanvas=(0,react.useMemo)((function(){return function(){var videoElement=webcamVideoRef.current;context&&videoElement?(context.drawImage.apply(context,function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}([videoElement],bounds,!1)),shouldDraw&&(null==onDraw||onDraw()),window.setTimeout(streamToCanvas,timeoutDelay)):setTimeout(streamToCanvas,100)}}),[shouldDraw,context]);(0,react.useEffect)((function(){var _a;!context&&canvasRef.current&&setContext(null===(_a=canvasRef.current)||void 0===_a?void 0:_a.getContext("2d")),hasPermission&&context&&webcamVideoRef.current&&(hasListener||(webcamVideoRef.current.addEventListener("play",(function(event){streamToCanvas()})),shouldPlay&&playWithRetry(webcamVideoRef.current).then(onPlay),setHasListener(!0)))}),[webcamVideoRef.current,hasPermission,context])},defaultDeviceChoiceOptions={matcher:/back/i,facingMode:"environment"},useWebcam=function(options){void 0===options&&(options={});var deviceChoiceOptions=options.deviceChoiceOptions,onDevices=options.onDevices,shouldPlay=options.shouldPlay,webcamVideoRef=(0,react.useRef)(null),hasPermission=function(){var _a=(0,react.useState)(!1),hasPermission=_a[0],setHasPermission=_a[1];return(0,react.useEffect)((function(){var active=!0;return resolveCameraPermission().then((function(permission){active&&setHasPermission(permission)})),function(){active=!1}}),[setHasPermission]),{hasPermission}}().hasPermission,deviceList=function(hasPermission,onDevices){var _a=(0,react.useState)([]),deviceList=_a[0],setDeviceList=_a[1];return(0,react.useEffect)((function(){var active=!0;return hasPermission&&listDevices().then((function(deviceList){active&&(setDeviceList(deviceList),null==onDevices||onDevices(deviceList))})),function(){active=!1}}),[hasPermission]),{deviceList}}(hasPermission,onDevices).deviceList,stream=function(hasPermission,deviceList,deviceChoiceOptions){var _a=(0,react.useState)(),stream=_a[0],setStream=_a[1],constraints=(0,react.useMemo)((function(){return getMediaConstraintsForDeviceChoiceOptions(deviceList,deviceChoiceOptions)}),[deviceList,deviceChoiceOptions]);return(0,react.useEffect)((function(){var active=!0;return hasPermission&&constraints&&getUserMedia(constraints).then((function(stream){active?setStream(stream):removeStreamTracks(stream)})).catch((function(error){return console.log("requested device not available",error),getUserMedia({video:{advanced:[{facingMode:"environment"}]}}).then(setStream).catch((function(error){return console.log("no environment-facing camera available",error),getUserMedia({video:!0}).then(setStream)}))})),function(){active=!1}}),[hasPermission,constraints]),{stream}}(hasPermission,deviceList,(0,react.useMemo)((function(){var _a,_b,_c,_d;return Object.assign({width:null!==(_b=null===(_a=webcamVideoRef.current)||void 0===_a?void 0:_a.width)&&void 0!==_b?_b:640,height:null!==(_d=null===(_c=webcamVideoRef.current)||void 0===_c?void 0:_c.height)&&void 0!==_d?_d:480},null!=deviceChoiceOptions?deviceChoiceOptions:defaultDeviceChoiceOptions)}),[webcamVideoRef.current,deviceChoiceOptions])).stream,isStreaming=useStreamToVideoElement(webcamVideoRef.current,stream,shouldPlay).isStreaming;return{webcamVideoRef,deviceList,hasPermission,stream,isStreaming}},useStreamToVideoElement=function(videoElement,stream,shouldPlay){var _a=(0,react.useState)(!1),isStreaming=_a[0],setIsStreaming=_a[1];return(0,react.useEffect)((function(){var active=!0;return!isStreaming&&videoElement&&stream&&(videoElement.srcObject=stream,shouldPlay&&videoElement.play().then((function(){active&&setIsStreaming(!0)})).catch((function(){active&&setIsStreaming(!1)}))),function(){active=!1}}),[stream,videoElement,isStreaming]),{isStreaming}},injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),BarcodeScanner=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[6].use[1]!./src/components/BarcodeScanner.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(BarcodeScanner.A,options);BarcodeScanner.A&&BarcodeScanner.A.locals&&BarcodeScanner.A.locals;const BarcodeScanner_BarcodeScanner=props=>{const{autoStart=!0,canvasHeight=240,canvasWidth=320,devices,onDevices,onScan,settings,videoHeight=480,videoWidth=640,videoCropHeight=300,videoCropWidth=640,zoom=1,blur=0}=props,webcamScannerPreviewBoxStyle={"--assume-video-width":`${videoWidth}px`,"--assume-video-height":`${videoHeight}px`,"--video-crop-width":`${videoCropWidth}px`,"--video-crop-height":`${videoCropHeight}px`,"--assume-zoom":zoom,"--video-blur":`${blur}px`},{canvasRef,hasPermission,webcamVideoRef}=function(options){var _a=options.zoom,zoom=void 0===_a?1:_a,deviceChoiceOptions=options.deviceChoiceOptions,onScan=options.onScan,onDevices=options.onDevices,_b=options.shouldPlay,shouldPlay=void 0===_b||_b,_c=useWebcam({deviceChoiceOptions,onDevices}),webcamVideoRef=_c.webcamVideoRef,hasPermission=_c.hasPermission,isStreaming=_c.isStreaming,stream=_c.stream,_d=useScanCanvas(onScan),onDraw=_d.onDraw,canDetect=_d.canDetect,canvasRef=_d.canvasRef,detectedBarcodesRef=_d.detectedBarcodesRef;return useVideoCanvas({onDraw,webcamVideoRef,shouldDraw:canDetect,canvasRef,hasPermission,shouldPlay,zoom}),{webcamVideoRef,canvasRef,stream,detectedBarcodes:detectedBarcodesRef.current,hasPermission,isStreaming}}({onDevices,onScan,shouldPlay:!1,zoom});return hasPermission&&devices?.length?react.createElement(react.Fragment,null,react.createElement("div",{className:"webcam-scanner-preview-box",style:webcamScannerPreviewBoxStyle},react.createElement("div",{className:"webcam-scanner-preview"},react.createElement("video",{ref:webcamVideoRef,width:videoWidth,height:videoHeight,autoPlay:autoStart,playsInline:!0}),react.createElement("canvas",{ref:canvasRef,width:canvasWidth,height:canvasHeight}),settings?.scanLine&&react.createElement("div",{className:"scanline"},"-")))):null};try{BarcodeScanner_BarcodeScanner.displayName="BarcodeScanner",BarcodeScanner_BarcodeScanner.__docgenInfo={description:"",displayName:"BarcodeScanner",props:{autoStart:{defaultValue:null,description:"",name:"autoStart",required:!1,type:{name:"boolean"}},canvasHeight:{defaultValue:null,description:"",name:"canvasHeight",required:!1,type:{name:"number"}},canvasWidth:{defaultValue:null,description:"",name:"canvasWidth",required:!1,type:{name:"number"}},devices:{defaultValue:null,description:"",name:"devices",required:!1,type:{name:"MediaDeviceInfo[]"}},onDevices:{defaultValue:null,description:"",name:"onDevices",required:!1,type:{name:"(devices: MediaDeviceInfo[]) => void"}},onScan:{defaultValue:null,description:"",name:"onScan",required:!0,type:{name:"(code: string) => void"}},preferDeviceLabelMatch:{defaultValue:null,description:"",name:"preferDeviceLabelMatch",required:!1,type:{name:"RegExp"}},settings:{defaultValue:null,description:"",name:"settings",required:!1,type:{name:"Record<string, boolean | RegExp>"}},videoHeight:{defaultValue:null,description:"",name:"videoHeight",required:!1,type:{name:"number"}},videoWidth:{defaultValue:null,description:"",name:"videoWidth",required:!1,type:{name:"number"}},videoCropHeight:{defaultValue:null,description:"",name:"videoCropHeight",required:!1,type:{name:"number"}},videoCropWidth:{defaultValue:null,description:"",name:"videoCropWidth",required:!1,type:{name:"number"}},zoom:{defaultValue:null,description:"",name:"zoom",required:!1,type:{name:"number"}},blur:{defaultValue:null,description:"",name:"blur",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/BarcodeScanner.tsx#BarcodeScanner"]={docgenInfo:BarcodeScanner_BarcodeScanner.__docgenInfo,name:"BarcodeScanner",path:"src/components/BarcodeScanner.tsx#BarcodeScanner"})}catch(__react_docgen_typescript_loader_error){}const BarcodeScanner_stories={component:props=>{const{scanLine=!1,canvasHeight=240,canvasWidth=320,videoHeight=480,videoWidth=640,videoCropHeight,videoCropWidth,zoom=1,blur=0}=props,[codes,setCodes]=(0,react.useState)([]),[devices,setDevices]=(0,react.useState)([]);return react.createElement(BarcodeScanner_BarcodeScanner,{devices,onDevices:devices=>{setDevices(devices)},onScan:code=>{setCodes(codes.concat(code))},settings:{scanLine},canvasWidth,canvasHeight,videoWidth,videoHeight,videoCropHeight,videoCropWidth,zoom,blur})},title:"Components/BarcodeScanner"},Primary={args:{scanLine:!1,zoom:2,blur:3,canvasHeight:240,canvasWidth:320,videoHeight:480,videoWidth:640,videoCropHeight:300,videoCropWidth:640}},__namedExportsOrder=["Primary"];Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  args: {\n    scanLine: false,\n    zoom: 2,\n    blur: 3,\n    canvasHeight: 240,\n    canvasWidth: 320,\n    videoHeight: 480,\n    videoWidth: 640,\n    videoCropHeight: 300,\n    videoCropWidth: 640\n  }\n}",...Primary.parameters?.docs?.source}}}}}]);